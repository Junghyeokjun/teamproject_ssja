<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="teamproject.ssja.mapper.MyPageMapper">

   
<resultMap id="userResultMap" type="teamproject.ssja.dto.userinfo.UserInfoDTO">
    <id property="m_No" column="m_no"/>
    <result property="m_Id" column="m_id"/>
    <result property="m_Name" column="m_name"/>
    <result property="m_NickName" column="m_nickname"/>
    <result property="m_Address1" column="m_address1"/>
    <result property="m_Address2" column="m_address2"/>
    <result property="m_ZipCode" column="m_zipcode"/>
    <result property="m_Grade" column="m_grade"/>
    <result property="m_Email" column="m_email"/>
    <result property="m_Phone" column="m_phone"/>
    <result property="m_Point" column="m_point"/>
    <result property="countCoupon" column="couponNum"/>
    <result property="countWish" column="widhNum"/>
    <result property="countPurchase" column="purNum"/>
    <result property="m_deletedate" column="m_deletedate"/>
    
	
</resultMap>
<select id="getUserInfoInMyPage" parameterType="long" resultMap="userResultMap">
    select m.m_no , m.m_id , m.m_name , m.m_nickname , m.m_address1 , m.m_address2 ,
     m.m_zipcode , m.m_grade , m.m_email , m.m_phone , m.m_point ,m.m_deletedate,
      nvl(c.countcoupon, 0) as couponNum, nvl(w.countwish, 0) as widhNum, nvl(p.countpurchase, 0) as purNum
    from members m
    left join (select m_no, count(*) as countcoupon from ownedcoupon group by m_no) c 
    on m.m_no = c.m_no
    left join (select m_no, count(*) as countwish from wishlist group by m_no) w 
    on m.m_no = w.m_no
    left join (select m_no, count(*) as countpurchase from purchase group by m_no) p 
    on m.m_no = p.m_no
    where m.m_no = #{username}
</select>

<<<<<<< HEAD
<update id="changeAddress" parameterType="AddressForm">
=======
<update id="changeAddress" parameterType="teamproject.ssja.dto.userinfo.AddressForm">
>>>>>>> dev_jhj
	update members set m_zipcode = #{zip_code}, m_address1 = #{address}, m_address2 = #{extra_address} where m_no = #{userId}
</update>

<update id="changePasswordProcess" parameterType="Map">
	update members set m_pw = #{newPassword} where m_id = #{username}
</update>

<update id="deleteUserEnroll" parameterType="String" >
update members set M_deletedate = sysdate + INTERVAL'7' day  where m_id=#{userId} 
</update>


<delete id="deleteEnrolledUsersAuth" parameterType="List">
    delete from authority where m_id in 
    <foreach item="enrolled" collection="enrolledDeleteUsers" open="(" separator="," close=")">
        #{enrolled}
    </foreach>
</delete>

</mapper>
